<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>个人中心 - 沪乐锦公寓</title>
<style>
html,body{margin:0;padding:0;box-sizing:border-box;}
body{font-family:-apple-system,system-ui,"Microsoft Yahei",sans-serif;background:#fff7f0;color:#333;}
header{background:#fff7f0;color:#ff7f32;padding:20px;border-radius:0 0 8px 8px;}
header h1{margin:0;font-size:22px;}
nav{background:#fff;padding:10px;display:flex;flex-wrap:wrap;gap:10px;}
nav a{color:#ff7f32;text-decoration:none;padding:6px 10px;border-radius:4px;}
nav a.active{background:#ffe2bf;}
main{padding:20px;}
.card{background:#fff;border:1px solid #ffe4c2;border-radius:8px;padding:15px;margin-bottom:20px;}
.card h2{margin-top:0;}
.table{width:100%;border-collapse:collapse;}
.table th,.table td{border:1px solid #ffe4c2;padding:8px;text-align:left;}
.table tbody tr:nth-child(even){background:#fff;}
.table tbody tr:nth-child(odd){background:#fff7f0;}
</style>
</head>
<body>
<header>
<h1>个人中心</h1>
</header>
<nav>
<a href="dashboard.html">总览</a>
<a href="rooms.html">房源管理</a>
<a href="tenants.html">租户中心</a>
<a href="facilities.html">娱乐设施</a>
<a href="orders.html">抢单中心</a>
<a href="stars.html">星豆系统</a>
<a href="statistics.html">数据统计</a>
<a href="contracts.html">合同管理</a>
<a href="profile.html" class="active">个人中心</a>
</nav>
<main>
<div class="card" id="userInfo">
<h2>账户信息</h2>
<p>姓名：<span id="userName">-</span></p>
<p>电话：<span id="userPhone">-</span></p>
<p>房源信息：<span id="userHouse">-</span></p>
<p>星豆余额：<span id="userStars">0</span> 枚</p>
</div>
<div class="card" id="starLogsSection">
<h2>星豆明细</h2>
<table class="table">
<thead><tr><th>类型</th><th>数量</th><th>备注</th><th>日期</th></tr></thead>
<tbody id="starLogs"></tbody>
</table>
</div>
</main>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase-adapter.js"></script>
<script>
async function renderProfile(){
  const { data: tenantsData, error: tenantsError } = await supabase.from('tenants').select('*').limit(1);
  if(tenantsError) console.error(tenantsError);
  const user = tenantsData && tenantsData[0] || {};
  document.getElementById('userName').textContent = user.user || '';
  document.getElementById('userPhone').textContent = user.phone || '';
  document.getElementById('userHouse').textContent = user.house || '';
  const { data: starsData, error: starsError } = await supabase.from('stars').select('*').limit(1);
  if(starsError) console.error(starsError);
  const balance = starsData && starsData[0] ? starsData[0].balance : 0;
  document.getElementById('userStars').textContent = balance || 0;
  const { data: logs, error: logError } = await supabase.from('starlogs').select('*').order('ts', { ascending: false });
  if(logError) console.error(logError);
  const tbody = document.getElementById('starLogs');
  if(!logs || logs.length===0){
    tbody.innerHTML = '<tr><td colspan="4">暂无记录</td></tr>';
  }else{
    tbody.innerHTML = logs.map(l => 
      '<tr><td>' + (l.type||'') + '</td><td>' + (l.amount||'') + '</td><td>' + (l.note||'') + '</td><td>' + (new Date(l.ts).toLocaleDateString()) + '</td></tr>'
    ).join('');
  }
}
renderProfile();
</script>
</body>
</html>
